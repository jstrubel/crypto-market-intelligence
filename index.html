<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clairvoyance Crypto Intelligence</title>
  <meta name="description" content="Professional crypto market intelligence — live regime detection and risk management." />
  <meta property="og:title" content="Clairvoyance Crypto Intelligence" />
  <meta property="og:description" content="Live regime detection & risk management powered by quantitative dashboards." />
  <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#070b14; --bg2:#0b1020; --surface:#0e1629; --panel:#0c1426; --border:#1e2a44;
      --muted:#94a3b8; --text:#e5e7eb; --brand:#7c3aed; --brand2:#22d3ee;
      --success:#22c55e; --warn:#f59e0b; --danger:#ef4444; --shadow:0 12px 40px rgba(3,10,38,.45); --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      background: radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.25), transparent 55%),
                  radial-gradient(1000px 500px at 90% 0%, rgba(34,211,238,.12), transparent 60%),
                  linear-gradient(180deg,var(--bg),var(--bg2));
      font-family:"Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .cv-container{max-width:1200px;margin:0 auto;padding:0 20px}
    /* Nav */
    .cv-nav{position:sticky;top:0;z-index:60;background:rgba(10,16,30,.7);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 0}
    .cv-brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .cv-dot{width:18px;height:18px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff 0, #fff0 60%), linear-gradient(135deg,var(--brand),var(--brand2)); box-shadow:0 0 24px rgba(124,58,237,.6)}
    .cv-title{font-size:16px}
    .tabs{display:flex;gap:6px;align-items:center}
    .cv-tab{padding:8px 12px;border-radius:10px;border:1px solid transparent;color:#cbd5e1;cursor:pointer;text-decoration:none}
    .cv-tab[aria-current="page"], .cv-tab.active{border-color:#2a375e;background:linear-gradient(180deg,#0e1629,#0b1324);color:#fff}
    .cv-actions{display:flex;align-items:center;gap:10px}
    .cv-btn{border:1px solid #30406b;background:linear-gradient(180deg,#15203b,#0f1a33);color:#e5e7eb;padding:8px 12px;border-radius:12px;font-weight:700;cursor:pointer;text-decoration:none}
    .cv-btn.primary{border-color:#5b38c9;background:linear-gradient(180deg,#7c3aed,#5b21b6);color:#fff}
    .cv-btn:hover{filter:brightness(1.05)}
    /* Hero */
    .cv-panel{background:linear-gradient(180deg,#0f1a33,#0b1222); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
    .cv-panel.header{padding:24px 20px;margin-top:14px}
    .cv-sub{color:var(--muted);font-size:13px}
    /* KPI grid */
    .cv-grid{display:grid;gap:14px;margin-top:16px}
    @media(min-width:640px){.cv-grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1024px){.cv-grid{grid-template-columns:repeat(5,1fr)}}
    .cv-tile{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:var(--shadow)}
    .cv-tile h4{margin:0 0 4px 0;font-size:12px;color:#c7cbd4;font-weight:600}
    .cv-value{font-size:28px;font-weight:800}
    .cv-status{font-size:12px;margin-top:4px;color:var(--muted)}
    .cv-good{color:var(--success)} .cv-mid{color:var(--warn)} .cv-bad{color:var(--danger)}
    /* Gauge */
    .cv-gauge{height:8px;border:1px solid #27324f;border-radius:999px;background:#0b1324;overflow:hidden}
    .cv-gauge>i{display:block;height:100%;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e);width:0%}
    /* Sections */
    .section{margin-top:20px}
    /* Chip */
    .cv-chip{padding:6px 10px;border-radius:999px;font-weight:800;border:1px solid #2a375e;font-size:12px}
    .cv-riskon{background:#0d1f14;color:#a7f3d0;border-color:#134e31}
    .cv-neutral{background:#1b1708;color:#fde68a;border-color:#5a4614}
    .cv-riskoff{background:#2a0f14;color:#fecaca;border-color:#5b2530}
    /* Footer */
    .cv-footer{opacity:.8;text-align:center;font-size:12px;margin:24px 0;color:#93a1b5}
    @media(max-width:700px){.row{flex-direction:column;align-items:flex-start;gap:8px}}
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <div class="cv-nav">
    <div class="cv-container row">
      <div class="cv-brand">
        <span class="cv-dot"></span>
        <span class="cv-title">Clairvoyance Crypto Intelligence</span>
      </div>
      <nav class="tabs" role="tablist">
        <a class="cv-tab active" href="#dashboard">Dashboard</a>
        <a class="cv-tab" href="#macro">Macro</a>
        <a class="cv-tab" href="#report">Weekly Report</a>
      </nav>
      <div class="cv-actions">
        <span id="cv-regime-chip" class="cv-chip cv-neutral">NEUTRAL</span>
        <a class="cv-btn" href="#subscribe">Subscribe</a>
        <a class="cv-btn primary" href="#export">Export PDF</a>
      </div>
    </div>
  </div>

  <!-- Hero -->
  <section class="cv-container cv-panel header">
    <h1 style="margin:0;font-size:28px;letter-spacing:.2px">Professional Crypto Market Intelligence</h1>
    <p class="cv-sub" style="margin:6px 0 0">
      Live regime detection & risk management powered by quantitative dashboards.
    </p>
  </section>

  <!-- KPI Tiles (hook your data by updating the values below or via API) -->
  <main class="cv-container">
    <div class="cv-grid section">
      <div class="cv-tile">
        <h4>Macro Liquidity</h4>
        <div class="cv-value" id="macro-score">53</div>
        <div class="cv-gauge" aria-label="Macro gauge"><i id="score-fill" style="width:53%"></i></div>
        <div class="cv-status" id="macro-status">RISK-ON wind (subject to USD)</div>
      </div>
      <div class="cv-tile">
        <h4>Market Health (Master)</h4>
        <div class="cv-value" id="master-score">45</div>
        <div class="cv-status">Breadth/liquidity composite</div>
      </div>
      <div class="cv-tile">
        <h4>Cascade Risk</h4>
        <div class="cv-value" id="cascade-score">64</div>
        <div class="cv-status">Fragility from leverage/liquidity</div>
      </div>
      <div class="cv-tile">
        <h4>Froth Index</h4>
        <div class="cv-value" id="froth-score">47</div>
        <div class="cv-status">Speculative heat</div>
      </div>
      <div class="cv-tile">
        <h4>USD / DXY</h4>
        <div class="cv-value" id="dxy-score">48</div>
        <div class="cv-status">Higher USD = headwind</div>
      </div>
    </div>

    <!-- Macro Panel -->
    <section id="macro" class="section cv-panel" style="padding:16px 16px 18px">
      <div class="row" style="gap:12px; align-items:flex-end;">
        <div>
          <h2 style="margin:0;font-size:18px">Macro Conditions</h2>
          <p class="cv-sub" style="margin:6px 0 0">Composite of USD trend, yield-curve slope, volatility & risk appetite.</p>
        </div>
        <div style="font-size:42px;font-weight:800" id="macro-score-big">53</div>
      </div>
      <div class="cv-gauge" style="margin-top:8px"><i id="macro-gauge" style="width:53%"></i></div>
      <div class="row" style="gap:12px; margin-top:12px">
        <div class="cv-tile" style="flex:1">
          <h4>DXY Score</h4>
          <div class="cv-value" id="dxy-subscore">48</div>
          <div class="cv-status" id="dxy-status">HEADWIND</div>
        </div>
        <div class="cv-tile" style="flex:1">
          <h4>Yield Curve (10Y−2Y)</h4>
          <div class="cv-value" id="yield-score">55</div>
          <div class="cv-status" id="yield-status">FLAT</div>
        </div>
        <div class="cv-tile" style="flex:1">
          <h4>VIX Score</h4>
          <div class="cv-value" id="vix-score">60</div>
          <div class="cv-status" id="vix-status">NORMAL</div>
        </div>
        <div class="cv-tile" style="flex:1">
          <h4>Risk Appetite</h4>
          <div class="cv-value" id="spy-score">52</div>
          <div class="cv-status" id="risk-status">RISK ON</div>
        </div>
      </div>
     <div class="row" style="gap:8px; align-items:center; margin-top:10px">
  <span id="dollar-chip" class="cv-chip cv-neutral">DOLLAR —</span>
  <span id="teny-chip" class="cv-chip cv-neutral">10Y —%</span>
  <span class="cv-sub" id="updated" style="margin-left:auto">Updated: —</span>
</div>
    </section>

    <footer class="cv-footer">
      © <span id="year"></span> Clairvoyance Crypto Intelligence · All rights reserved
    </footer>
  </main>

  <script>
    // ---- Utilities ----
    function n(id){
      const el = document.getElementById(id);
      if(!el) return null;
      const v = parseFloat((el.textContent||'').replace(/[^0-9.-]/g,''));
      return Number.isFinite(v) ? v : null;
    }
    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
    function band(x){ if(x==null) return 'neutral'; return x>=60?'riskon':x<=40?'riskoff':'neutral'; }
    function paintRegime(){
      const scores = {
        macro:  n('macro-score'),
        health: n('master-score') || n('market-health-score'),
        cascade:n('cascade-score'),
        froth:  n('froth-score'),
        usd:    n('usd-score') || n('dxy-score')
      };
      const votes = Object.values(scores).map(band);
      const on=votes.filter(v=>v==='riskon').length, off=votes.filter(v=>v==='riskoff').length;
      const regime = on>off?'RISK ON': off>on?'RISK OFF':'NEUTRAL';
      const chip = document.getElementById('cv-regime-chip');
      if(chip){
        chip.textContent = regime;
        chip.classList.remove('cv-riskon','cv-riskoff','cv-neutral');
        chip.classList.add(regime==='RISK ON'?'cv-riskon': regime==='RISK OFF'?'cv-riskoff':'cv-neutral');
      }
    }
    function setText(id, val){ const el=document.getElementById(id); if(el && val!=null){ el.textContent=val; } }
    function setGauge(id, v){ const el=document.getElementById(id); if(el && v!=null){ el.style.width = clamp(v,0,100)+'%'; } }
    document.getElementById('year').textContent = new Date().getFullYear();
    
    function paintStatus(id, text){
  const el = document.getElementById(id);
  if(!el) return;
  el.textContent = text || '—';
  el.classList.remove('cv-good','cv-bad','cv-mid');
  if(/TAILWIND|RISK ON|LOW FEAR|STEEP/.test(text)) el.classList.add('cv-good');
  else if(/HEADWIND|RISK OFF|HIGH FEAR|INVERTED/.test(text)) el.classList.add('cv-bad');
  else el.classList.add('cv-mid');
}

function paintChip(id, text){
  const el = document.getElementById(id);
  if(!el) return;
  el.textContent = (id==='teny-chip' && text) ? `10Y ${text}%` :
                   (id==='dollar-chip' ? `DOLLAR ${text||'—'}` : (text||'—'));
  el.classList.remove('cv-riskon','cv-riskoff','cv-neutral');
  el.classList.add(text==='TAILWIND' ? 'cv-riskon' :
                   text==='HEADWIND' ? 'cv-riskoff' : 'cv-neutral');

    // Initial paint from defaults above
    (function init(){
      const m = n('macro-score');
      setText('macro-score-big', m); setGauge('macro-gauge', m);
      setGauge('score-fill', m);
      paintRegime();
      document.getElementById('updated').textContent = 'Updated: ' + new Date().toLocaleString();
    })();

    // ---- Optional: fetch server-side data if your endpoints exist ----
    async function fetchJSON(url){
      const r = await fetch(url, { cache: 'no-store' });
      if(!r.ok) throw new Error(url + ' -> ' + r.status);
      return r.json();
    }

    async function refreshFromAPI(){
      try{
        // Macro endpoint (from earlier suggestions)
        const macro = await fetchJSON('/api/macro');
        if(macro?.metrics){
          const mm = macro.metrics;
          setText('macro-score', Math.round(mm.macro));
          setText('macro-score-big', Math.round(mm.macro));
          setGauge('macro-gauge', mm.macro);
          setGauge('score-fill', mm.macro);
          if(mm.dxyScore!=null) setText('dxy-subscore', Math.round(mm.dxyScore));
          if(mm.tenScore!=null){ setText('yield-score', Math.round(mm.tenScore)); }
          if(mm.vixScore!=null){ setText('vix-score', Math.round(mm.vixScore)); }
          if(mm.spyScore!=null){ setText('spy-score', Math.round(mm.spyScore)); }
        }
        if(macro?.status){
      paintStatus('dxy-status',   macro.status.dollarImpact);
      paintStatus('yield-status', macro.status.yieldStatus);
      paintStatus('vix-status',   macro.status.vixStatus);
      paintStatus('risk-status',  macro.status.riskAppetite);

          // new: update the chips
      paintChip('dollar-chip', macro.status.dollarImpact);
      paintChip('teny-chip',   macro.status.tenYear);
          
        }
        document.getElementById('updated').textContent = 'Updated: ' + new Date().toLocaleString();
      }catch(e){ /* silently ignore if endpoint not present */ }

      // Health / Cascade / Froth / USD via TradingView ingest endpoints (optional)
      const TRY = async (url) => { try{ return await fetch('/api/'+url, { cache:'no-store' }).then(r=>r.ok?r.json():null); }catch(_){ return null; } };
      const health = await TRY('tv-ingest-health');
      if(health?.metrics?.health!=null) setText('master-score', Math.round(health.metrics.health));
      const cascade = await TRY('tv-ingest-cascade');
      if(cascade?.metrics?.cascade!=null) setText('cascade-score', Math.round(cascade.metrics.cascade));
      const froth = await TRY('tv-ingest-froth');
      if(froth?.metrics?.froth!=null) setText('froth-score', Math.round(froth.metrics.froth));
      const usd = await TRY('tv-ingest-usd');
      if(usd?.metrics?.usd!=null) setText('dxy-score', Math.round(usd.metrics.usd));

      paintRegime();
    }

    // Try to refresh every 30s if endpoints exist
    refreshFromAPI();
    setInterval(refreshFromAPI, 30000);
  </script>
<script>
async function loadMacro() {
  try {
    const r = await fetch('/api/macro', { cache: 'no-store' });
    const j = await r.json();

    const score = (j.metrics?.macro ?? 50);
    const regime = score >= 55 ? 'RISK ON' : score <= 45 ? 'RISK OFF' : 'NEUTRAL';

    document.getElementById('macro-score').textContent = score.toFixed(1);
    document.getElementById('regime').textContent = regime;
    document.getElementById('dxy-trend').textContent = j.status?.dxyTrend ?? '—';
    document.getElementById('yield-status').textContent = j.status?.yieldStatus ?? '—';
    document.getElementById('vix-status').textContent = j.status?.vixStatus ?? '—';
    document.getElementById('risk-appetite').textContent = j.status?.riskAppetite ?? '—';
    document.getElementById('ten-year').textContent = j.status?.tenYear ?? '—';
  } catch (e) {
    console.error(e);
  }
}
loadMacro();                // initial load
setInterval(loadMacro, 30000); // refresh every 30s
</script>

</body>
</html>
